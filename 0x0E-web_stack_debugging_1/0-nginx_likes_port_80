#!/usr/bin/env bash

# Install net-tools if not already installed
if ! command -v netstat > /dev/null; then
  sudo apt update
  sudo apt install -y net-tools
fi

# Check if Nginx is listening on port 80
if ! netstat -tuln | grep -q ':80'; then
  # Start Nginx if not running
  if ! pgrep -x "nginx" > /dev/null; then
    sudo systemctl start nginx
  fi

  # Check Nginx configuration for errors
  if sudo nginx -t | grep -q 'test is successful'; then
    # Update Nginx configuration file to listen on port 80
    sudo sed -i 's/.*listen\s*80.*/    listen 80;/g' /etc/nginx/nginx.conf

    # Restart Nginx
    sudo systemctl restart nginx

    # Check if Nginx is now listening on port 80
    if netstat -tuln | grep -q ':80'; then
      echo "Nginx is now listening on port 80."
    else
      echo "Failed to configure Nginx to listen on port 80."
    fi
  else
    echo "Nginx configuration has errors. Please fix the configuration file: /etc/nginx/nginx.conf"
  fi
else
  echo "Nginx is already listening on port 80."
fi

